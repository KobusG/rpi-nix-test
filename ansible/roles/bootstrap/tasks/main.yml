---
- name: Install sudo
  become: yes
  become_method: su
  apt:
    name: sudo
    state: present
  when: ansible_facts['lsb']['id'] == "Debian"

- name: Add the user to the sudoers
  become: yes
  become_method: su
  copy:
    content: "{{ ansible_user_id }} ALL=(ALL) NOPASSWD: ALL"
    dest: "/etc/sudoers.d/{{ ansible_user_id }}"

- name: Install Python3
  become: yes
  apt:
    name: python3
    state: present

- name: Disable password authentication
  become: yes
  lineinfile:
    dest: /etc/ssh/sshd_config
    line: "PasswordAuthentication no"
    state: present
  notify:
    - restart ssh

- name: Deploy SSH publich key
  become: yes
  authorized_key:
    user: "{{ ansible_user_id }}"
    state: present
    key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

- name: Install essential packages for Ansible
  become: yes
  apt:
    name:
      - aptitude
    state: present
